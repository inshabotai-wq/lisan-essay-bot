<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Al Lisan ¬∑ Insha Generator</title>
    <!-- Custom Font -->
    <style>
        @font-face {
            font-family: 'LisanFont';
            src: url('lisan_font.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
    </style>
    <!-- Google Fonts (fallback) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Noto+Naskh+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- FileSaver for Word export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: #0b0f1a;
            color: #e0e4f0;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Splash screen */
        #splash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0b0f1a;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 1s ease;
            pointer-events: none;
        }

        .splash-logo {
            text-align: center;
            animation: fadeInScale 1.5s ease-out;
        }

        .splash-logo img {
            height: 120px;
            width: auto;
            margin-bottom: 1rem;
            filter: drop-shadow(0 0 30px #fbbf24);
        }

        .splash-logo .logo-text {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(to right, #fef3c7, #fde68a, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
        }

        .splash-logo .logo-text span {
            font-family: 'Noto Naskh Arabic', serif;
            font-size: 4rem;
            margin-right: 0.5rem;
            background: linear-gradient(to right, #fef3c7, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Main content (initially hidden) */
        #main-content {
            opacity: 0;
            transition: opacity 1s ease;
        }

        /* Background */
        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 20% 30%, #1e2b4a, #0a0f1a);
        }

        .gradient-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(125deg, rgba(100,80,220,0.15) 0%, rgba(40,180,220,0.1) 50%, rgba(220,80,160,0.1) 100%);
            filter: blur(80px);
            z-index: -1;
            animation: gradientShift 20s ease infinite;
        }

        @keyframes gradientShift {
            0% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.2); }
            100% { opacity: 0.5; transform: scale(1); }
        }

        .main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 3rem;
            position: relative;
            z-index: 10;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-area img {
            height: 50px;
            width: auto;
            filter: drop-shadow(0 0 10px #fbbf24);
        }

        .logo-text {
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            background: linear-gradient(to right, #fef3c7, #fde68a, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-text span {
            font-family: 'Noto Naskh Arabic', serif;
            font-size: 2.2rem;
            margin-right: 0.3rem;
            background: linear-gradient(to right, #fef3c7, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .tagline {
            font-weight: 300;
            color: #9aa4bf;
            letter-spacing: 1px;
            font-size: 1rem;
            text-transform: uppercase;
            border-left: 2px solid #3f4e77;
            padding-left: 1.5rem;
        }

        /* Pill buttons */
        .pill {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 40px;
            padding: 0.6rem 1.8rem;
            font-size: 1rem;
            font-weight: 500;
            color: #fde68a;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
            white-space: nowrap;
        }

        .pill:hover {
            background: rgba(245, 158, 11, 0.25);
            border-color: #fbbf24;
            box-shadow: 0 0 15px #fbbf24;
        }

        .pill i {
            margin-right: 6px;
        }

        /* Hero */
        .hero {
            text-align: center;
            margin-bottom: 2rem;
        }

        .hero h1 {
            font-size: 4.5rem;
            font-weight: 800;
            line-height: 1.2;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .hero-gold {
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #d97706, #b45309);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shine 5s infinite;
            font-size: 5rem;
            display: inline-block;
        }

        @keyframes shine {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .hero-sub {
            font-size: 1.3rem;
            color: #a6b0cc;
            max-width: 700px;
            margin: 0 auto 1rem;
        }

        .hero-desc {
            font-size: 1.3rem;
            color: #fde68a;
            margin-bottom: 1.5rem;
            text-shadow: 0 0 8px #fbbf24;
            border-bottom: 2px solid #fbbf24;
            display: inline-block;
            padding-bottom: 0.3rem;
        }

        /* Disclaimer banner */
        .disclaimer-banner {
            background: rgba(245, 158, 11, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 60px;
            padding: 1rem 2rem;
            margin: 0 0 2rem 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            font-size: 1.1rem;
            color: #fde68a;
            box-shadow: 0 10px 25px -8px #b45309;
            width: 100%;
            text-align: center;
        }

        .disclaimer-banner i {
            font-size: 1.8rem;
            color: #fbbf24;
        }

        /* Main input row (topic only) */
        .topic-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .topic-label {
            font-size: 1.3rem;
            font-weight: 500;
            color: #fde68a;
            white-space: nowrap;
        }

        .topic-wrapper {
            flex: 1;
            display: flex;
            background: rgba(20, 30, 50, 0.4);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 60px;
            padding: 0.5rem 0.5rem 0.5rem 2rem;
            align-items: center;
            gap: 0.8rem;
            transition: box-shadow 0.3s ease;
            animation: pulseGlow 2s 3;
        }

        @keyframes pulseGlow {
            0% { box-shadow: 0 25px 45px -15px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.05) inset; }
            50% { box-shadow: 0 30px 60px -10px #fbbf24, 0 0 0 2px #fbbf24 inset; }
            100% { box-shadow: 0 25px 45px -15px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.05) inset; }
        }

        .topic-wrapper:focus-within {
            box-shadow: 0 30px 55px -10px #fbbf24, 0 0 0 2px #fbbf24 inset;
            animation: none;
        }

        .topic-wrapper i {
            color: #7f8fb2;
            font-size: 1.5rem;
        }

        #topic {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            font-family: 'Outfit', sans-serif;
            font-size: 1.3rem;
            color: white;
            padding: 1rem 0;
        }

        #topic::placeholder {
            color: #5f6f92;
            font-weight: 300;
        }

        /* Controls row (type, word count, toggle, generate) */
        .controls-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .type-select {
            background: rgba(20, 30, 50, 0.6);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 40px;
            padding: 0.8rem 2rem;
            font-size: 1rem;
            font-family: 'Outfit', sans-serif;
            color: #fde68a;
            outline: none;
            cursor: pointer;
            backdrop-filter: blur(8px);
            appearance: none;
            background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23fbbf24' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><polyline points='6 9 12 15 18 9'/></svg>");
            background-repeat: no-repeat;
            background-position: right 1.5rem center;
            background-size: 1.2rem;
            padding-right: 3.5rem;
        }

        .type-select option {
            background: #1a1f30;
            color: #e0e4f0;
        }

        .type-select:hover {
            border-color: #fbbf24;
        }

        .word-select {
            min-width: 120px;
        }

        .ayah-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #fde68a;
            background: rgba(245,158,11,0.1);
            padding: 0.6rem 1.5rem;
            border-radius: 40px;
            border: 1px solid rgba(245,158,11,0.3);
            cursor: pointer;
            backdrop-filter: blur(5px);
            white-space: nowrap;
        }
        .ayah-toggle input {
            width: 18px;
            height: 18px;
            accent-color: #fbbf24;
        }

        .generate-btn {
            background: linear-gradient(145deg, #fbbf24, #d97706);
            border: none;
            border-radius: 50px;
            padding: 0.8rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #0b0f1a;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 15px 25px -8px #b45309, 0 0 0 1px rgba(255,255,255,0.2) inset;
            white-space: nowrap;
        }

        .generate-btn i {
            font-size: 1.2rem;
            transition: transform 0.3s;
        }

        .generate-btn:hover {
            background: linear-gradient(145deg, #fcd34d, #f59e0b);
            transform: scale(1.02);
            box-shadow: 0 20px 35px -5px #d97706;
        }

        .generate-btn:hover i {
            transform: translateX(5px);
        }

        /* Result area */
        .result-section {
            margin-bottom: 2rem;
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .result-header h2 {
            font-size: 1.4rem;
            font-weight: 500;
            color: #cfd9f0;
            letter-spacing: 0.5px;
        }

        .result-header i {
            font-size: 1.8rem;
            color: #fbbf24;
            filter: drop-shadow(0 0 8px #fbbf24);
        }

        .essay-card {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(20px);
            border-radius: 40px;
            padding: 2rem;
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 30px 50px -20px #00000080, 0 0 0 1px rgba(255,255,255,0.05) inset;
            transition: all 0.3s;
            position: relative;
        }

        .essay-card:hover {
            border-color: rgba(251, 191, 36, 0.3);
            box-shadow: 0 40px 70px -15px #b45309;
        }

        #result {
            font-family: 'LisanFont', 'Noto Naskh Arabic', serif;
            font-size: 1.5rem;
            line-height: 2;
            color: #ecf0fa;
            white-space: pre-wrap;
            word-wrap: break-word;
            min-height: 300px;
            max-height: 600px;
            overflow-y: auto;
            direction: rtl;
            text-align: right;
            padding-right: 0.5rem;
        }

        #result::-webkit-scrollbar {
            width: 8px;
        }
        #result::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        #result::-webkit-scrollbar-thumb {
            background: #fbbf24;
            border-radius: 10px;
        }

        .result-placeholder {
            color: #7a89b0;
            font-style: italic;
            text-align: center;
            padding: 80px 20px;
            font-family: 'Outfit', sans-serif;
            direction: ltr;
            font-size: 1.3rem;
        }

        /* Floating help button inside result card */
        .help-ai-float {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid #fbbf24;
            border-radius: 40px;
            padding: 0.5rem 1.2rem;
            font-size: 0.9rem;
            color: #fde68a;
            cursor: pointer;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
            z-index: 5;
        }

        .help-ai-float:hover {
            background: rgba(245, 158, 11, 0.4);
            box-shadow: 0 0 15px #fbbf24;
        }

        .help-ai-float i {
            font-size: 1rem;
        }

        /* Word count display */
        .word-count {
            margin-top: 1rem;
            font-size: 1rem;
            color: #a0aec0;
            text-align: right;
            padding-right: 1rem;
        }

        /* Export buttons */
        .export-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .export-btn {
            background: rgba(20, 30, 50, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 40px;
            padding: 0.8rem 2rem;
            font-size: 1rem;
            font-weight: 500;
            color: #e0e4f0;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .export-btn i {
            color: #fbbf24;
            font-size: 1.2rem;
        }

        .export-btn:hover {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.15);
            color: #fde68a;
        }

        /* Ad container */
        .ad-container {
            background: rgba(10, 15, 30, 0.4);
            backdrop-filter: blur(8px);
            border-radius: 60px;
            padding: 2rem;
            text-align: center;
            border: 1px dashed #3f4e77;
            color: #8e9fc3;
            margin: 2rem 0 2rem;
            transition: all 0.3s;
        }

        .ad-container i {
            font-size: 2.5rem;
            color: #4b5e8c;
            margin-bottom: 0.5rem;
        }

        .ad-container:hover {
            border-color: #fbbf24;
            color: #fde68a;
        }

        /* Footer */
        footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 2rem;
            padding: 2rem 0 1rem;
            border-top: 1px solid rgba(255,255,255,0.05);
            color: #6f7da0;
        }

        .footer-links {
            display: flex;
            gap: 2.5rem;
        }

        .footer-links a {
            color: #8e9fc3;
            text-decoration: none;
            font-size: 1rem;
            transition: color 0.2s;
            cursor: pointer;
        }

        .footer-links a:hover {
            color: #fbbf24;
        }

        .copyright {
            font-size: 0.95rem;
            color: #9ca3af;
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #1a1f30;
            border-radius: 40px;
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 30px 60px -15px black;
            color: #e0e4f0;
            position: relative;
        }

        .modal-content h3 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(to right, #fef3c7, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modal-content p {
            margin-bottom: 1.5rem;
            line-height: 1.8;
            color: #b0bad4;
        }

        .modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: none;
            border: none;
            color: #8e9fc3;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s;
        }

        .modal-close:hover {
            color: #fff;
        }

        .modal-btn {
            background: #fbbf24;
            border: none;
            color: #0b0f1a;
            padding: 0.8rem 2rem;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .modal-btn:hover {
            background: #fcd34d;
        }

        /* Gamification elements */
        .word-counter {
            background: #fbbf24;
            color: #0b0f1a;
            border-radius: 20px;
            padding: 0.2rem 0.8rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }

        .fun-message {
            color: #fbbf24;
            font-weight: 500;
            margin-top: 1rem;
        }

        /* Responsive */
        @media (max-width: 1000px) {
            .main {
                padding: 2rem;
            }
            .hero h1 {
                font-size: 3.5rem;
            }
            .hero-gold {
                font-size: 4rem;
            }
        }

        @media (max-width: 700px) {
            .header-right {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            .topic-row, .controls-row {
                flex-direction: column;
                align-items: stretch;
            }
            .topic-label {
                text-align: center;
            }
            .type-select, .word-select, .ayah-toggle, .generate-btn {
                width: 100%;
            }
            .hero h1 {
                font-size: 2.8rem;
            }
            .hero-gold {
                font-size: 3.2rem;
            }
            .essay-card {
                padding: 1.5rem;
            }
            .disclaimer-banner {
                font-size: 1rem;
                padding: 0.8rem 1rem;
            }
            .export-buttons {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash">
        <div class="splash-logo">
            <img src="lisan_logo.png" alt="Al Lisan Logo">
            <div class="logo-text">
                <span>ŸÑÿ≥ÿßŸÜ</span> ¬∑ AL LISAN
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="main-content">
        <div id="bg-canvas"></div>
        <div class="gradient-overlay"></div>

        <div class="main">
            <!-- Header -->
            <header>
                <div class="logo-area">
                    <img src="lisan_logo.png" alt="Al Lisan Logo">
                    <div class="logo-text">
                        <span>ŸÑÿ≥ÿßŸÜ</span> ¬∑ AL LISAN
                    </div>
                </div>
                <div class="header-right">
                    <div class="tagline">Insha Generator ¬∑ Pure Lisan‚Äëud‚ÄëDawat</div>
                    <div class="pill" onclick="showModal('disclaimer')">
                        <i class="fas fa-info-circle"></i> Disclaimer
                    </div>
                    <div class="pill" onclick="showModal('about')">
                        <i class="fas fa-pen-fancy"></i> About
                    </div>
                </div>
            </header>

            <!-- Hero -->
            <div class="hero">
                <h1>
                    <span class="hero-gold">Insha Generator</span><br>
                    <span class="hero-sub">AI‚ÄëPowered Essays</span>
                </h1>
                <div class="hero-desc">
                    Authentic Lisan‚Äëud‚ÄëDawat ¬∑ Muqaddama ‚Üí Bayan ‚Üí Natijah ¬∑ Quran & Hadith
                </div>
            </div>

            <!-- Disclaimer Banner (updated text) -->
            <div class="disclaimer-banner">
                <i class="fas fa-language"></i>
                <span><strong>Type your topic in any script (Urdu, Arabic, English or Lisan-ud-Dawat).</strong> The essay will always be generated in pure Lisan‚Äëud‚ÄëDawat script.</span>
            </div>

            <!-- Topic input row -->
            <div class="topic-row">
                <span class="topic-label">Write an insha on</span>
                <div class="topic-wrapper">
                    <i class="fas fa-pen"></i>
                    <input type="text" id="topic" placeholder="e.g., ilm ki fazilat, ŸàÿßŸÑÿØ€åŸÜ ⁄©€å ÿÆÿØŸÖÿ™" dir="auto" autofocus>
                </div>
            </div>

            <!-- Controls row -->
            <div class="controls-row">
                <select id="essayType" class="type-select">
                    <option value="Expository">Expository</option>
                    <option value="Descriptive">Descriptive</option>
                    <option value="Analytical">Analytical</option>
                    <option value="Narrative">Narrative</option>
                    <option value="Other">Other</option>
                </select>
                <select id="wordCount" class="type-select word-select">
                    <option value="100">100 words</option>
                    <option value="200" selected>200 words</option>
                    <option value="300">300 words</option>
                    <option value="400">400 words</option>
                    <option value="500">500 words</option>
                    <option value="600">600 words</option>
                    <option value="700">700 words</option>
                    <option value="800">800 words</option>
                </select>
                <label class="ayah-toggle">
                    <input type="checkbox" id="includeAyah" checked>
                    <span>Include Ayah & Hadith</span>
                </label>
                <button class="generate-btn" id="generateBtn" onclick="generateEssay()">
                    <span>Generate</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>

            <!-- Result section -->
            <div class="result-section">
                <div class="result-header">
                    <i class="fas fa-scroll"></i>
                    <h2>Your Essay</h2>
                </div>
                <div class="essay-card">
                    <!-- Floating help button (gamified) -->
                    <div class="help-ai-float" onclick="openWordModal()">
                        <i class="fas fa-brain"></i> Help AI Learn
                        <span class="word-counter" id="userContributionCount">0</span>
                    </div>
                    <div id="result">
                        <div class="result-placeholder">
                            <i class="fas fa-pencil-alt" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.6;"></i>
                            <p>Enter a topic above and generate a masterpiece.</p>
                        </div>
                    </div>
                    <div class="word-count" id="wordCountDisplay"></div>
                </div>
                <div class="export-buttons" id="exportButtons" style="display: none;">
                    <button class="export-btn" onclick="exportPDF()"><i class="fas fa-file-pdf"></i> Export as PDF</button>
                    <button class="export-btn" onclick="exportWord()"><i class="fas fa-file-word"></i> Export as Word</button>
                </div>
            </div>

            <!-- AdSense placeholder -->
            <div class="ad-container" id="adPlaceholder">
                <i class="fas fa-ad"></i>
                <p>Advertisement ¬∑ Google AdSense will appear here after approval.</p>
            </div>

            <!-- Footer -->
            <footer>
                <div class="copyright">
                    ¬© 2026 Al Lisan ¬∑ Insha Generator
                </div>
                <div class="footer-links">
                    <a onclick="showModal('about')"><i class="fas fa-info-circle"></i> About</a>
                    <a onclick="showModal('privacy')"><i class="fas fa-shield-alt"></i> Privacy</a>
                    <a href="mailto:insha.bot.ai@gmail.com"><i class="fas fa-envelope"></i> Contact</a>
                </div>
            </footer>
        </div>
    </div>

    <!-- Word Submission Modal (Gamified) -->
    <div id="wordModalOverlay" class="modal-overlay" onclick="closeWordModal(event)">
        <div class="modal-content" style="max-width: 450px;">
            <button class="modal-close" onclick="closeWordModal(event)"><i class="fas fa-times"></i></button>
            <h3>‚ú® Help the AI Learn ‚ú®</h3>
            <p>The AI needs your knowledge! Below is an English word it wants to learn in Lisan‚Äëud‚ÄëDawat.</p>
            <div style="background: rgba(255,255,255,0.05); border-radius: 20px; padding: 1.5rem; text-align: center; margin-bottom: 1.5rem;">
                <div style="font-size: 2rem; font-weight: bold; color: #fbbf24; margin-bottom: 0.5rem;" id="unknownWord">knowledge</div>
                <p style="color: #b0bad4;">Type its Lisan‚Äëud‚ÄëDawat equivalent:</p>
                <input type="text" id="lisanTranslation" style="width:100%; padding:0.8rem; background: rgba(255,255,255,0.05); border:1px solid #3f4e77; border-radius:20px; color:white; font-family:'LisanFont','Noto Naskh Arabic'; direction:rtl; text-align:right;">
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span id="funMessage" class="fun-message"></span>
                <button class="modal-btn" onclick="submitTranslation()">Submit & Earn üèÜ</button>
            </div>
            <p style="margin-top: 1rem; font-size: 0.9rem; color: #8e9fc3;">You've helped with <span id="contributionCount">0</span> words so far!</p>
        </div>
    </div>

    <!-- Generic Modals (About, Privacy, Disclaimer) -->
    <div id="modal-overlay" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content" id="modal-content">
            <button class="modal-close" onclick="closeModal(event)"><i class="fas fa-times"></i></button>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        // Firebase configuration (YOUR actual config)
        const firebaseConfig = {
            apiKey: "AIzaSyBGFi26eysIW59qPY4HE2pLoWPYk33EJuE",
            authDomain: "al-lisan-ai.firebaseapp.com",
            projectId: "al-lisan-ai",
            storageBucket: "al-lisan-ai.firebasestorage.app",
            messagingSenderId: "340294975078",
            appId: "1:340294975078:web:5f6b978228f7e5e95977a7"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Gamification: user's contribution count (stored locally)
        let userContributions = localStorage.getItem('alLisanContributions') ? parseInt(localStorage.getItem('alLisanContributions')) : 0;
        document.getElementById('userContributionCount').innerText = userContributions;
        document.getElementById('contributionCount').innerText = userContributions;

        // List of unknown words (for demo ‚Äì in production this could come from a Firestore collection)
        const unknownWords = [
            "knowledge", "patience", "charity", "parents", "prayer", "fasting", "honesty", "mercy", "gratitude", "wisdom"
        ];
        let currentUnknownIndex = Math.floor(Math.random() * unknownWords.length);
        document.getElementById('unknownWord').innerText = unknownWords[currentUnknownIndex];

        // Splash screen
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.getElementById('splash').style.opacity = '0';
                setTimeout(function() {
                    document.getElementById('splash').style.display = 'none';
                    document.getElementById('main-content').style.opacity = '1';
                }, 1000);
            }, 2000);
        });

        // Generic modal functions
        const modalOverlay = document.getElementById('modal-overlay');
        const modalBody = document.getElementById('modal-body');

        function showModal(type) {
            let title, content;
            if (type === 'about') {
                title = 'About Al Lisan';
                content = `<p>Al Lisan is an AI‚Äëpowered tool that generates high‚Äëquality essays in pure Lisan‚Äëud‚ÄëDawat, the language of the Dawoodi Bohra community. It follows the classical structure: <strong>Muqaddama</strong> (introduction), <strong>Bayan</strong> (detailed discussion), and <strong>Natijah</strong> (conclusion), enriched with Quranic verses and Hadith.</p>
                          <p><strong>Features:</strong></p>
                          <ul>
                              <li>Accepts topics in any script (English, Urdu, Arabic, Roman)</li>
                              <li>Always outputs in authentic Lisan‚Äëud‚ÄëDawat script</li>
                              <li>Powered by advanced AI, guided by community contributions</li>
                              <li>Free for the community, with no login required</li>
                          </ul>`;
            } else if (type === 'privacy') {
                title = 'Your Privacy is Safe';
                content = `<p>We do not collect, store, or share any personal information. The topics you enter are used only to generate your essay and are not saved. Word submissions are stored anonymously to help improve the AI.</p>
                          <p>We use Google AdSense for ads, which may use cookies, but we have no access to that data. For more details, please refer to Google's privacy policy.</p>`;
            } else if (type === 'disclaimer') {
                title = 'Disclaimer';
                content = `<p>This AI tool is under active development. While we strive for accuracy, responses may occasionally be imperfect or contain errors. The AI is trained on the <em>style</em> of authentic sermons but cannot replicate actual Sermon Bayan or Kalaam ‚Äì those remain the preserve of our community's living tradition.</p>
                          <p>Always refer to qualified scholars for religious matters. Use this tool as a learning aid, not as a definitive source.</p>`;
            }
            modalBody.innerHTML = `<h3>${title}</h3>${content}`;
            modalOverlay.style.display = 'flex';
        }

        function closeModal(event) {
            if (event.target === modalOverlay || event.target.closest('.modal-close')) {
                modalOverlay.style.display = 'none';
            }
        }

        // Word submission modal
        const wordModalOverlay = document.getElementById('wordModalOverlay');
        const funMessage = document.getElementById('funMessage');

        function openWordModal() {
            // Pick a random unknown word
            currentUnknownIndex = Math.floor(Math.random() * unknownWords.length);
            document.getElementById('unknownWord').innerText = unknownWords[currentUnknownIndex];
            document.getElementById('lisanTranslation').value = '';
            funMessage.innerText = '';
            wordModalOverlay.style.display = 'flex';
        }

        function closeWordModal(event) {
            if (event.target === wordModalOverlay || event.target.closest('.modal-close')) {
                wordModalOverlay.style.display = 'none';
            }
        }

        function submitTranslation() {
            const englishWord = document.getElementById('unknownWord').innerText;
            const lisanTranslation = document.getElementById('lisanTranslation').value.trim();
            if (!lisanTranslation) {
                alert('Please enter the Lisan‚Äëud‚ÄëDawat equivalent.');
                return;
            }

            // Store in Firestore
            db.collection('wordSubmissions').add({
                english: englishWord,
                lisan: lisanTranslation,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                // Update contribution count
                userContributions++;
                localStorage.setItem('alLisanContributions', userContributions);
                document.getElementById('userContributionCount').innerText = userContributions;
                document.getElementById('contributionCount').innerText = userContributions;

                // Show fun message
                const messages = [
                    "ÿ¥ŸÉÿ±ÿßŸã! You're amazing! üéâ",
                    "Great! The AI just got smarter! üß†",
                    "You earned a knowledge point! üåü",
                    "Another word mastered! üí™",
                    "Thanks for being a language hero! ü¶∏"
                ];
                funMessage.innerText = messages[Math.floor(Math.random() * messages.length)];

                // Clear input and pick a new word after a short delay
                setTimeout(() => {
                    openWordModal(); // show a new word
                }, 1500);
            })
            .catch((error) => {
                console.error('Error adding document: ', error);
                alert('Sorry, there was an error. Please try again later.');
            });
        }

        // Essay generation (same as before, but with fixed functions)
        let currentEssay = '';

        function countWords(str) {
            return str.trim().split(/\s+/).length;
        }

        async function generateEssay() {
            const topicInput = document.getElementById('topic');
            const topic = topicInput.value.trim();
            const typeSelect = document.getElementById('essayType');
            const essayType = typeSelect.value;
            const wordCountSelect = document.getElementById('wordCount');
            const wordCount = wordCountSelect.value;
            const includeAyah = document.getElementById('includeAyah').checked;

            const resultDiv = document.getElementById('result');
            const wordCountSpan = document.getElementById('wordCountDisplay');
            const generateBtn = document.getElementById('generateBtn');
            const btnText = generateBtn.querySelector('span');
            const btnIcon = generateBtn.querySelector('.fa-arrow-right');
            const exportButtons = document.getElementById('exportButtons');

            if (!topic) {
                alert('Please enter a topic');
                return;
            }

            // Loading state
            const originalBtnText = btnText.innerText;
            btnText.innerText = 'Generating';
            btnIcon.style.display = 'none';
            const spinner = document.createElement('span');
            spinner.className = 'spinner';
            spinner.style.cssText = 'display:inline-block; width:20px; height:20px; border:3px solid rgba(255,255,255,0.3); border-radius:50%; border-top-color:white; animation:spin 0.8s linear infinite; margin-left:10px;';
            generateBtn.appendChild(spinner);
            generateBtn.disabled = true;

            if (!document.getElementById('spinner-keyframes')) {
                const style = document.createElement('style');
                style.id = 'spinner-keyframes';
                style.innerHTML = '@keyframes spin { to { transform: rotate(360deg); } }';
                document.head.appendChild(style);
            }

            resultDiv.innerHTML = `
                <div style="text-align: center; padding: 80px 20px;">
                    <i class="fas fa-feather-alt fa-spin" style="font-size: 4rem; color: #fbbf24; margin-bottom: 20px;"></i>
                    <p style="color: #a6b0cc; font-size: 1.3rem;">Crafting your essay in Lisan‚Äëud‚ÄëDawat...</p>
                </div>
            `;
            if (wordCountSpan) wordCountSpan.innerHTML = '';
            exportButtons.style.display = 'none';

            try {
                const response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        topic,
                        type: essayType,
                        words: wordCount,
                        includeAyah: includeAyah
                    })
                });

                const data = await response.json();

                if (data.essay) {
                    const footerLine1 = "ÿßÿ∑ÿßŸÑ ÿßŸÑŸÑŸá ÿπŸÖÿ± ÿ≥ŸäÿØŸÜÿß ŸÖŸèŸÄŸÅŸÄÿ∂ŸëŸÄŸÑ ÿ≥ŸÄŸäŸÄŸÅŸè Ÿ±ŸÑŸÄÿØŸëŸäŸÜ ÿßŸÑŸâ ŸäŸàŸÖ ÿßŸÑÿØŸäŸÜ. ÿßŸÖŸäŸÜ";
                    const footerLine2 = "you will have to add Sermon bayan and Kalaam , check disclaimer for more info.";
                    let fullEssay = data.essay + "\n\n" + footerLine1 + "\n" + footerLine2;
                    currentEssay = fullEssay;
                    resultDiv.innerHTML = `<div style="direction: rtl; text-align: right;">${fullEssay.replace(/\n/g, '<br>')}</div>`;
                    const actualWords = countWords(fullEssay);
                    wordCountSpan.innerHTML = `üìù Word count: ${actualWords} (requested: ${wordCount})`;
                    exportButtons.style.display = 'flex';
                } else {
                    currentEssay = '';
                    resultDiv.innerHTML = `
                        <div class="result-placeholder">
                            <i class="fas fa-exclamation-triangle" style="color: #e55; font-size: 2.5rem; margin-bottom: 15px;"></i>
                            <p>Error: ${data.error || 'Something went wrong'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                currentEssay = '';
                resultDiv.innerHTML = `
                    <div class="result-placeholder">
                        <i class="fas fa-wifi-slash" style="color: #e55; font-size: 2.5rem; margin-bottom: 15px;"></i>
                        <p>Network error. Please try again.</p>
                    </div>
                `;
            } finally {
                btnText.innerText = originalBtnText;
                btnIcon.style.display = 'inline-block';
                if (spinner) spinner.remove();
                generateBtn.disabled = false;
            }
        }

        // Export functions
        function exportPDF() {
            if (!currentEssay) return;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const note = "If the text does not display correctly, please install the Al-Kanz font. You can download it from Google Fonts.";
            doc.setFontSize(10);
            doc.setTextColor(100);
            doc.text(note, 15, 10);
            const splitText = doc.splitTextToSize(currentEssay, 180);
            doc.setFontSize(12);
            doc.setTextColor(0);
            doc.text(splitText, 15, 20);
            doc.save('Al_Lisan_Essay.pdf');
        }

        function exportWord() {
            if (!currentEssay) return;
            const note = "If the text does not display correctly, please install the Al-Kanz font. You can download it from Google Fonts.\n\n";
            const fullContent = note + currentEssay;
            const blob = new Blob([fullContent], { type: 'application/msword' });
            saveAs(blob, 'Al_Lisan_Essay.doc');
        }
    </script>
</body>
</html>
